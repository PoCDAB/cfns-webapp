{% extends "base.html" %}
{% load static %}

{% load leaflet_tags %}

{% block title %}
  <title>Geoview</title>
{% endblock %}

{% block head %}
    {% leaflet_js %}
    {% leaflet_css %}
    <link rel="stylesheet" type="text/css" href="{% static '/css/geoview.css' %}">
    <script type="text/javascript" src="{% static '/js/leaflet.ajax.js' %}"></script>

{% endblock %}

{% block body-fluid %}

<div class="container-fluid">
  <div class="d-flex flex-wrap">
    <div class="col-lg-2">
      <h3 class="m-2">Filters:</h3>
      <form method="post">
        {% csrf_token %}
        <table class="d-flex justify-content-center">
          {% if form.subject.errors %}
            <ol role="alertdialog">
                {% for error in form.subject.errors %}
                <li role="alert"><strong>{{ error|escape }}</strong></li>
                {% endfor %}
            </ol>
            {% endif %}
    
            <table class="table table-hover">
              <tbody>
            {% for field in form %}
                <tr class="m-0 p-0">
                  <td class="col-lg-1">
                    {{ field }}
                    {% if field.help_text %}
                      <p class="help">{{ field.help_text|safe }}</p>
                    {% endif %}
                  </td>
                  <td class="m-0 p-0 col-lg-11">
                    {{ field.label_tag }}{% if field.field.required %}<span class="required">*</span>{% endif %}
                  </td>
                </tr>
          {% endfor %}
        </tbody>
        </table>
        <button class="btn btn-success w-100" type="submit">Toepassen</button>
      </form>
    </div>
    <div class="col-lg-8">
      <script>
         function onEachAISFeature(feature, layer) {
          if (feature.properties) {
            
          } else {
            layer.bindPopup(JSON.stringify(feature.properties,null,'</br>'));
          }
        }

        function map_init (map, options) {
          // Use Leaflet API here
          var datasets = new L.GeoJSON.AJAX("{% url 'ais-data' %}", {
              onEachFeature: function (feature, layer) {
                layer.bindPopup(
                "<b>AIS</b>" +
                "</br>mmsi: " + feature.properties?.mmsi.toString() +
                "</br>Schipnaam: " + feature.properties?.name.toString() +
                "</br>" + feature.properties?.updated_at.toString()
              );
            }
          }).addTo(map);
        }
      </script>
      {% leaflet_map "geoview" callback="window.map_init" %}
    </div>
    <div class="col-lg-2">
      <h3 class="m-2">Legenda:</h3>

      Ruimte voor een legenda.
    </div>
  </div>
</div>
{% endblock %}
